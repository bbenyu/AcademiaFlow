<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text Combiner for Researchers</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/docxtemplater/3.28.0/docxtemplater.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/FileSaver.js/2.0.5/FileSaver.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            text-align: center;
            padding: 20px;
            font-size: 18px;
        }
        h1 { color: #333; }
        p { color: #555; margin-bottom: 20px; }
        .grid-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }
        .snippet {
            background-color: #fff;
            border: 1px solid #ccc;
            padding: 15px;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0,0,0,0.1);
            opacity: 0;
            animation: fadeIn 0.5s forwards;
        }
        @keyframes fadeIn {
            to { opacity: 1; }
        }
        textarea {
            width: 100%;
            height: 80px;
            margin: 10px 0;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 16px;
            transition: height 0.3s;
        }
        textarea:focus { height: 120px; }
        input {
            width: 100%;
            margin: 5px 0;
            padding: 5px;
            border: 1px solid #ccc;
            border-radius: 3px;
            font-size: 16px;
        }
        button {
            padding: 12px 24px;
            margin: 10px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 18px;
            transition: background-color 0.3s;
        }
        button:hover { background-color: #0056b3; }
        select {
            padding: 12px;
            font-size: 18px;
            margin: 10px;
            width: 200px;
        }
        #output-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            justify-content: center;
            align-items: center;
        }
        #output-content {
            background-color: white;
            padding: 20px;
            border-radius: 5px;
            width: 80%;
            max-width: 600px;
            text-align: left;
            position: relative;
        }
        #output-text {
            white-space: pre-wrap;
            margin-bottom: 20px;
            font-size: 16px;
            cursor: text;
        }
        #copy-message {
            display: none;
            color: green;
            margin-right: 10px;
            animation: fadeInOut 2s;
        }
        @keyframes fadeInOut {
            0% { opacity: 0; }
            10% { opacity: 1; }
            90% { opacity: 1; }
            100% { opacity: 0; }
        }
        .close-btn {
            position: absolute;
            top: 10px;
            right: 10px;
            cursor: pointer;
            font-size: 30px;
            padding: 10px;
        }
        .button-container {
            display: flex;
            justify-content: flex-end;
            align-items: center;
        }
    </style>
</head>
<body>
    <h1>Text Combiner for Researchers</h1>
    <p>
        Combine text snippets and manage citations effortlessly. Input your snippets and references, choose a citation style, and generate a polished output with a bibliography.
    </p>
    <div id="snippets-container" class="grid-container">
        <div class="snippet">
            <h3>Text Snippet 1</h3>
            <textarea id="snippet1" placeholder="Paste your first text snippet here" spellcheck="true"></textarea>
            <input type="text" id="ref1" placeholder="e.g., Smith, J. (2020). Title. Journal.">
        </div>
    </div>
    <select id="citationStyle" onchange="updatePlaceholders()">
        <option value="apa">APA</option>
        <option value="mla">MLA</option>
        <option value="chicago">Chicago</option>
        <option value="harvard">Harvard</option>
        <option value="ieee">IEEE</option>
        <option value="ama">AMA</option>
        <option value="vancouver">Vancouver</option>
        <option value="turabian">Turabian</option>
        <option value="oscola">OSCOLA</option>
        <option value="bluebook">Bluebook</option>
    </select>
    <button onclick="combineText()">Combine & Generate Bibliography</button>
    <button onclick="clearAll()">Clear All</button>
    <div id="output-modal">
        <div id="output-content">
            <span class="close-btn" onclick="closeModal()">Ã—</span>
            <h2>Your Research Synthesis</h2>
            <div id="output-text"></div>
            <div class="button-container">
                <span id="copy-message">Copied!</span>
                <button onclick="copyText()">Copy to Clipboard</button>
                <button onclick="savePDF()">Save as PDF</button>
                <button onclick="saveText()">Save as Text</button>
                <button onclick="saveDocx()">Save as DOCX</button>
                <button onclick="saveToGoogleDrive()">Save to Google Drive</button>
                <button onclick="saveToDropbox()">Save to Dropbox</button>
            </div>
        </div>
    </div>
    <script>
        let snippetCount = 1;

        function addSnippet() {
            snippetCount++;
            const container = document.getElementById('snippets-container');
            const newSnippet = document.createElement('div');
            newSnippet.className = 'snippet';
            newSnippet.innerHTML = `
                <h3>Text Snippet ${snippetCount}</h3>
                <textarea id="snippet${snippetCount}" placeholder="Paste your text snippet here" spellcheck="true"></textarea>
                <input type="text" id="ref${snippetCount}" placeholder="${getPlaceholder()}">
            `;
            container.appendChild(newSnippet);
            newSnippet.scrollIntoView({ behavior: 'smooth' });
            updateAutoAdd();
        }

        function updateAutoAdd() {
            const lastSnippet = document.getElementById(`snippet${snippetCount}`);
            lastSnippet.addEventListener('input', function() {
                if (lastSnippet.value.trim() !== '') {
                    addSnippet();
                }
            }, { once: true });
        }

        function getPlaceholder() {
            const style = document.getElementById('citationStyle').value;
            switch (style) {
                case 'apa': return 'e.g., Smith, J. (2020). Title. Journal.';
                case 'mla': return 'e.g., Smith, John. "Title." Journal, 2020.';
                case 'chicago': return 'e.g., Smith, John. 2020. Title. Journal.';
                default: return 'Reference';
            }
        }

        function updatePlaceholders() {
            for (let i = 1; i <= snippetCount; i++) {
                const refInput = document.getElementById(`ref${i}`);
                if (refInput) refInput.placeholder = getPlaceholder();
            }
        }

        function combineText() {
            const snippets = [];
            const references = [];
            for (let i = 1; i <= snippetCount; i++) {
                const snippet = document.getElementById(`snippet${i}`).value;
                const ref = document.getElementById(`ref${i}`).value;
                if (snippet && ref) {
                    snippets.push(snippet);
                    references.push(ref);
                }
            }
            const style = document.getElementById('citationStyle').value;
            let combined = snippets.map((s, i) => `${s} (${references[i].split(",")[0]}, ${references[i].split(",")[1]})`).join("\n\n");
            const bibliography = generateBibliography(references, style);
            const outputText = combined + "\n\nBibliography:\n" + bibliography;
            document.getElementById('output-text').innerText = outputText;
            document.getElementById('output-modal').style.display = 'flex';
        }

        function generateBibliography(references, style) {
            let bib = "";
            references.forEach(ref => {
                const parts = ref.split(",").map(p => p.trim());
                if (parts.length < 2) return;
                switch (style) {
                    case "apa":
                        bib += `${parts[0]}. (${parts[1]}). ${parts[2] || "Untitled"}.\n`;
                        break;
                    case "mla":
                        bib += `${parts[0].split(" ").pop()}, ${parts[0].split(" ")[0]}. "${parts[2] || "Untitled"}." ${parts[1]}.\n`;
                        break;
                    default:
                        bib += `${parts[0]}, ${parts[1]}, ${parts[2] || "Untitled"}\n`;
                }
            });
            return bib;
        }

        function closeModal() {
            document.getElementById('output-modal').style.display = 'none';
        }

        function copyText() {
            const text = document.getElementById('output-text').innerText;
            navigator.clipboard.writeText(text).then(() => {
                const message = document.getElementById('copy-message');
                message.style.display = 'inline';
                setTimeout(() => message.style.display = 'none', 2000);
            });
        }

        function savePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            doc.text(document.getElementById('output-text').innerText, 10, 10);
            doc.save('research_synthesis.pdf');
        }

        function saveText() {
            const text = document.getElementById('output-text').innerText;
            const blob = new Blob([text], { type: 'text/plain' });
            const link = document.createElement('a');
            link.href = URL.createObjectURL(blob);
            link.download = 'research_synthesis.txt';
            link.click();
        }

        function saveDocx() {
            const text = document.getElementById('output-text').innerText;
            const doc = new docxtemplater(new JSZip(), { paragraphLoop: true });
            const content = `
                <w:document xmlns:w="http://schemas.openxmlformats.org/wordprocessingml/2006/main">
                    <w:body>
                        <w:p><w:r><w:t>${text.replace(/\n/g, '</w:t></w:r></w:p><w:p><w:r><w:t>')}</w:t></w:r></w:p>
                    </w:body>
                </w:document>`;
            doc.loadZip(new JSZip()).setData(content).render();
            const blob = doc.getZip().generate({ type: 'blob' });
            saveAs(blob, 'research_synthesis.docx');
        }

        function saveToGoogleDrive() {
            alert('Google Drive integration requires API setup. Placeholder for now.');
        }

        function saveToDropbox() {
            alert('Dropbox integration requires API setup. Placeholder for now.');
        }

        function clearAll() {
            const container = document.getElementById('snippets-container');
            container.innerHTML = `
                <div class="snippet">
                    <h3>Text Snippet 1</h3>
                    <textarea id="snippet1" placeholder="Paste your first text snippet here" spellcheck="true"></textarea>
                    <input type="text" id="ref1" placeholder="${getPlaceholder()}">
                </div>
            `;
            snippetCount = 1;
            updateAutoAdd();
        }

        document.getElementById('output-text').addEventListener('click', function(e) {
            if (e.detail === 1 && !window.getSelection().toString()) {
                const range = document.createRange();
                range.selectNodeContents(this);
                const selection = window.getSelection();
                selection.removeAllRanges();
                selection.addRange(range);
            }
        });

        updateAutoAdd();
    </script>
</body>
</html>
